# [D5. Ahoy, PCAP'n]

**Category:** [Network Forensics] | **Difficulty:** [Medium] | **Points:** [300]

---

## Challenge

The threat actor (TA) has contacted us with their demands and now we have some "evidence" of what sensitive data may have been stolen. But how did they get the sensitive data in the first place? And importantly, do we need to worry about them still being active in our environment?
We've received an alert that may be related to this threat actor activity and could clue us in as to where and how they stole the data they are now ransoming.
But where exactly are they and what are they doing, besides holding your sensitive data for ransom?
Pirating your super-secret client-monitoring software?
Stealing your intellectual property or your confidential financial plans for next year?
Hijacking your social media feed?
Coercing your company systems into acting as a botnet crew for their nefarious purposes?
In the vast ocean of network traffic monitored by the company's Network Security team, you need to find out:
the compromised machine's name
and the Command-and-Control (C2) IP address of the threat actor (where they are sending the data to)

The Network Security team has packet captures ("PCAPs") of the company's network traffic around the time of the alert, but due to a tight Information Technology (IT) budget and a lack of resources, it's limited to a small window of time.
Great. Sarcastically send a reminder to yourself to make the IT team "walk the plank!" for how much this corner-cutting will cost the company!
You'll just have to work with what's available, and the clues the Incident Management team has provided about the TA's demands.
Time to get your hands dirty and start digging (or swimming) through the PCAPs! Take the leap into the (Wire)Shark-infested waters and find the treasure!

---

## Solution

I used Wireshark to analyze network traffic patterns, focusing on identifying unusual outbound communications that could indicate data exfiltration.

### Steps
1. Filtered out irrelevant protocols - Started by sorting by protocol column, then filtered out ARP, HTTP, and ICMP traffic since these weren't likely used for exfiltration
2. Focused on DNS traffic - Applied filter for DNS protocol and immediately noticed suspicious patterns: random-looking subdomains like d6fqqac.musictag.ir and z73remh.commons.wikimedia.org across multiple unrelated domains
3. Identified the exfiltration pattern - Found consistent traffic between internal IP (10.x.x.x range) and external IP (251.x.x.x), then used "Statistics -> Resolved Names" feature to quickly map the internal IP to its hostname
---

## Notes
- Key technique: DNS tunneling detection through subdomain analysis and traffic pattern recognition
- What made this tricky: Had to recognize that legitimate-looking domains were being abused for data exfiltration
- Time taken: 45 minutes